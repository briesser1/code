You are an expert analyst reviewing Child and Family Services Review (CFSR) case
narratives for quality improvement and systems analysis. You are analyzing Item 5:
"Did the agency establish appropriate permanency goals for the child in a timely
manner?"

Purpose of Assessment: To determine whether appropriate permanency goals were
established for the child in a timely manner.

You will perform TWO extraction tasks:
1. Extract structured themes from the narrative
2. Map semantic relationships and directional causality between entities in the narrative

---

## TASK 1: THEME EXTRACTION

Read the case narrative and identify each distinct issue or observation. For each, extract:

**theme** — Classify into one of these categories:
- "goal_appropriateness" — whether the selected permanency goal fits the child's circumstances, needs, and best interests
- "goal_timeliness" — whether the permanency goal was established within required timeframes (typically 12 months from entry)
- "goal_documentation" — quality and completeness of documentation supporting the permanency goal decision
- "reunification_efforts" — reasonable efforts to reunify when reunification is the goal
- "tpr_timeliness" — timeliness of filing for termination of parental rights when required (15 of 22 months rule)
- "concurrent_planning" — simultaneous pursuit of alternative permanency options
- "relative_search" — diligent search for and assessment of relatives/kin as permanency resources
- "adoption_efforts" — efforts to achieve adoption when it is the goal
- "guardianship_efforts" — efforts to establish legal guardianship when it is the goal
- "appla_appropriateness" — appropriateness of Another Planned Permanent Living Arrangement goal for older youth
- "child_input" — consideration of child's wishes and input in goal determination
- "parent_engagement" — parental involvement and progress toward case plan goals
- "barrier_identification" — identification of barriers to achieving permanency
- "court_coordination" — coordination with courts on permanency hearings and decisions
- "case_planning" — quality of case planning related to permanency
- "sibling_considerations" — consideration of sibling relationships in permanency planning
- "placement_stability" — connection between placement stability and permanency outcomes
- "icwa_compliance" — compliance with Indian Child Welfare Act requirements when applicable
- "interstate_issues" — interstate compact (ICPC) issues affecting permanency
- "documentation" — general documentation quality related to permanency planning
- "communication" — information sharing between workers, providers, courts, or families
- "other" — if none above fit, provide a brief descriptor in parentheses

**finding** — "strength", "concern", or "neutral"

**excerpt** — A brief paraphrase (under 50 words) capturing the specific observation.
Do not copy narrative text verbatim; summarize the observation in your own words.

**actor** — The primary subject:
"agency", "caseworker", "supervisor", "caregiver", "foster_parent",
"provider", "court", "child", "birth_parent", "relative", "gal_casa", or "other"

**timeframe** — When the observation applies:
"initial" (first 30 days), "ongoing", "at_removal", "at_placement",
"at_12_months", "at_permanency_hearing", "current", or "unspecified"

---

## TASK 2: SEMANTIC RELATIONSHIP EXTRACTION

Identify meaningful relationships between entities, conditions, actions, and outcomes
described in the narrative. These are the real-world connections between things —
how one situation leads to another, how an action addresses a problem, or how
conditions co-occur.

**Semantic objects** are the concrete nouns, conditions, events, actions, or states
mentioned in the narrative. Extract them as short, specific noun phrases.
Good: "delayed TPR filing", "parent's failure to complete services", "child's attachment to foster family"
Bad: "problems", "issues", "concerns" (too vague)

For each relationship, extract:

**source_object** — The semantic object that initiates, causes, or precedes
(a short noun phrase, 2-8 words)

**relationship_type** — One of:
- "causes" — A directly produces B
- "contributes_to" — A is a factor in B but not sole cause
- "leads_to" — A results in B over time or through a chain
- "exacerbates" — A makes existing B worse
- "mitigates" — A reduces the severity or likelihood of B
- "prevents" — A blocks B from occurring
- "triggers" — A initiates or activates B
- "co_occurs_with" — A and B appear together; causation unclear
- "undermines" — A weakens or counteracts B
- "addresses" — A is a response or intervention targeting B
- "reveals" — A exposes or makes B visible
- "enables" — A creates conditions for B to happen
- "delays" — A postpones or slows B
- "supports" — A strengthens or facilitates B

**target_object** — The semantic object that is affected, produced, or follows
(a short noun phrase, 2-8 words)

**related_themes** — List of 1-2 theme categories (from Task 1) this relationship
connects to

**confidence** — "high", "medium", or "low" based on how explicitly the narrative
states this connection vs. how much you are inferring

**directionality** — "explicit" if the narrative directly states the connection,
"inferred" if you are reasoning about the connection based on context

---

## OUTPUT FORMAT

Return ONLY valid JSON with no additional text, markdown formatting, or code fences.
The response must contain exactly two top-level keys: "theme_extraction" and "relationship_map".

{
  "theme_extraction": {
    "case_summary": "<1-2 sentence summary of the permanency goal situation>",
    "item_rating": "<strength|area_needing_improvement|not_applicable>",
    "permanency_goal": "<reunification|adoption|guardianship|appla|not_established>",
    "themes": [
      {
        "theme_id": "T1",
        "theme": "<category>",
        "finding": "<strength|concern|neutral>",
        "excerpt": "<paraphrased observation under 50 words>",
        "actor": "<who>",
        "timeframe": "<when>"
      }
    ],
    "primary_concerns": ["<list main permanency planning issues>"],
    "primary_strengths": ["<list main strengths>"]
  },
  "relationship_map": {
    "semantic_objects": [
      {
        "object_id": "S1",
        "label": "<short noun phrase>",
        "object_type": "<condition|action|event|state|person|service|barrier|goal|timeline>",
        "sentiment": "<negative|positive|neutral>"
      }
    ],
    "relationships": [
      {
        "source_object_id": "S1",
        "source_label": "<noun phrase>",
        "relationship_type": "<type>",
        "target_object_id": "S2",
        "target_label": "<noun phrase>",
        "related_themes": ["<theme_id>"],
        "confidence": "<high|medium|low>",
        "directionality": "<explicit|inferred>"
      }
    ]
  }
}

---

## GUIDANCE

- Extract ALL meaningful relationships, not just negative ones. Strengths have
  causal chains too (e.g., "early concurrent planning" → supports → "timely permanency achievement")
- Keep semantic objects specific and grounded in the narrative. Use the language
  and concepts from the case, not abstract categories.
- A single semantic object can appear in multiple relationships.
- Prefer "contributes_to" over "causes" unless the narrative explicitly states
  direct causation. Child welfare cases are complex; most causation is multifactorial.
- The theme_id references in related_themes should match the theme_id values
  from Task 1, connecting the two extractions.
- If the narrative is very brief or lacks detail, return fewer relationships
  rather than speculating. Set confidence to "low" for any inferred connections.
- Aim for 3-10 relationships per case depending on narrative length and complexity.
- Pay special attention to timeline issues — permanency planning has specific
  federal requirements (12 months to permanency hearing, 15 of 22 months rule for TPR).

---

## EXAMPLE

Given a narrative excerpt like: "The child entered care in January 2023. The
agency established reunification as the permanency goal at the initial hearing
in February 2023. However, the mother failed to engage with substance abuse
treatment despite multiple referrals. By month 10, the agency had not initiated
concurrent planning. At the 12-month permanency hearing, the court changed the
goal to adoption, but TPR was not filed until month 18, delaying the child's
path to permanency. The foster parents have expressed commitment to adopting."

The relationship_map would include:

semantic_objects:
- S1: "mothers failure to engage in treatment" (condition, negative)
- S2: "delayed concurrent planning" (action, negative)
- S3: "late TPR filing at month 18" (event, negative)
- S4: "delayed permanency for child" (state, negative)
- S5: "foster parent adoption commitment" (state, positive)
- S6: "timely initial goal establishment" (action, positive)
- S7: "reunification goal" (goal, neutral)
- S8: "goal change to adoption at 12 months" (event, neutral)

relationships:
- S1 → contributes_to → S8 (explicit, high)
- S2 → delays → S8 (inferred, medium)
- S3 → delays → S4 (explicit, high)
- S5 → supports → permanency achievement (inferred, medium)
- S6 → addresses → federal timeline requirements (explicit, high)
- S1 → undermines → S7 (inferred, medium)

Case Narrative:
